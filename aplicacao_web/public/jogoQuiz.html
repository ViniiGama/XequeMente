<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/logoBranco_NomeXequeMente.svg">
    <link rel="stylesheet" href="style/jogoQuiz.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script> -->
    <title>XequeMente</title>
</head>

<body onload="onloadEsconder()">
    <div class="container">
        <div class="container_menu_lateral">
            <div class="container_linha_menu_lateral">
                <div class="logo_botoes">

                    <img src="assets/logoXequeMente2.png" alt="">
                    <h2>Bem-vindo, <b id="b_usuario">usuário</b>!</h2>
                    <h1> <a href="jogoQuiz.html">Jogar</a></h1>
                    <h1> <a href="dashboardXequeMente.html">Estatística</a></h1>
                </div>

                <div class="botao_sair">
                    <button class="btn-logout" onclick="limparSessao()">Sair</button>
                </div>
            </div>
        </div>
        <div class="container_quiz">
            <div class="container_linha_quiz">


                <div class="tudo">
                    <div class="texto_cima_botao" id="texto_cima_botao">
                        <h1><b>Bem-vindo</b> ao salão de jogos</h1>
                        <h1>Está preparado para ser <b>desafiado?</b> <br><b>Clique</b> no botão abaixo</h1>
                    </div>

                    <div id="pontuacaoEJogo" class="pontuacaoEJogo">
                        <button id="btnIniciarQuiz" onclick="iniciarQuiz()" class="botao_iniciar">INICIAR QUIZ</button>

                        <div id="pontuacao" class="container_pontuacao">
                            <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                                <span class="width-fit-content">Quantidade de acertos: <span id="spanCertas"></span></span>
                                <span class="width-fit-content">Quantidade de erros: <span id="spanErradas"></span></span>
                            </div>
                            <div id="pontuacaoFinalJogo" class="flex-colunar padding-8">
                                <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                                    <span id="spanPontuacaoFinal">***</span>
                                </span>
                                <span id="msgFinal" class="width-fit-content">***</span>
                            </div>
                        </div>

                        <div id="jogo" class="container_perguntas_respostas">

                            <div id="infoQuestao" class="infoQuestao">
                                <span>Questão atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span> questões.</span>
                            </div>

                            <div id="perguntaDaQuestaoAtual" class="perguntaDaQuestaoAtual">
                                <span id="spanQuestaoExibida" class="text-bold"></span>
                            </div>

                            <!-- <div id="infoAlternativas" class="padding-8">
                                <span><em>Escolha uma opção dentre as abaixo:</em></span>
                            </div> -->

                            <div id="opcoes" class="opcoes_respostas">
                                <span>
                                    <input type="radio" id="primeiraOpcao" name="option" class="radio"
                                        value="alternativaA" />
                                    <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
                                </span>
                                <span>
                                    <input type="radio" id="segundaOpcao" name="option" class="radio"
                                        value="alternativaB" />
                                    <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
                                </span>
                                <span>
                                    <input type="radio" id="terceiraOpcao" name="option" class="radio"
                                        value="alternativaC" />
                                    <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
                                </span>
                                <span>
                                    <input type="radio" id="quartaOpcao" name="option" class="radio"
                                        value="alternativaD" />
                                    <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
                                </span>
                            </div>

                            <div id="botoes" class="botoes_quiz">
                                <button onclick="submeter()" id="btnSubmeter">Submeter resposta</button>
                                <button onclick="avancar()" id="btnProx" disabled>Avançar para próxima questão</button>
                                <!-- <button onclick="finalizar()" id="btnConcluir" disabled>Finalizar Quiz</button> -->
                                <button onclick="tentarNovamente()" id="btnTentarNovamente" disabled>Tentar
                                    novamente</button>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</body>

</html>
<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO
    function sair() {
        window.location.href = 'site.html'
    }


    const listaDeQuestoes = [

        {
            pergunta: "No início de uma partida, quantas casas tem um tabuleiro de xadrez?",
            alternativaA: "32",
            alternativaB: "64",
            alternativaC: "100",
            alternativaD: "50",
            alternativaCorreta: "alternativaB"
        },

        {
            pergunta: "Qual é a única peça do xadrez que pode pular outras peças durante o seu movimento normal?",
            alternativaA: "Bispo",
            alternativaB: "Torre",
            alternativaC: "Rainha",
            alternativaD: "Cavalo",
            alternativaCorreta: "alternativaD"
        },

        {
            pergunta: "Como se movimenta a peça Torre no tabuleiro?",
            alternativaA: "Apenas nas diagonais",
            alternativaB: "Em forma de 'L'",
            alternativaC: "Horizontal e verticalmente, quantas casas quiser, sem pular peças",
            alternativaD: "Apenas uma casa por vez, em qualquer direção",
            alternativaCorreta: "alternativaC"
        },

        {
            pergunta: "O que acontece quando um peão atinge a última fileira do tabuleiro?",
            alternativaA: "Ele é removido do jogo",
            alternativaB: "Ele vira automaticamente uma Rainha",
            alternativaC: "Ele pode ser promovido a qualquer outra peça (exceto Rei ou Peão)",
            alternativaD: "O jogo termina imediatamente",
            alternativaCorreta: "alternativaC"
        },

        {
            pergunta: "Qual o principal objetivo do jogo de xadrez?",
            alternativaA: "Capturar todas as peças do adversário",
            alternativaB: "Promover pelo menos um peão",
            alternativaC: "Capturar a Rainha adversária",
            alternativaD: "Dar 'xeque-mate' no Rei adversário",
            alternativaCorreta: "alternativaD"
        },

        {
            pergunta: "Qual é o único movimento no xadrez em que duas peças se movem simultaneamente em um único turno?",
            alternativaA: "Captura 'en passant'",
            alternativaB: "Promoção do peão",
            alternativaC: "O roque",
            alternativaD: "Declaração de empate",
            alternativaCorreta: "alternativaC"
        },

        {
            pergunta: "Quantas casas o Rei pode se mover por vez?",
            alternativaA: "Quantas casas quiser, em qualquer direção",
            alternativaB: "Duas casas na primeira jogada, uma nas seguintes",
            alternativaC: "Apenas uma casa em qualquer direção (horizontal, vertical ou diagonal)",
            alternativaD: "Apenas na diagonal",
            alternativaCorreta: "alternativaC"
        },

        {
            pergunta: "Qual das seguintes peças é considerada a mais poderosa no jogo, depois do Rei?",
            alternativaA: "Torre",
            alternativaB: "Bispo",
            alternativaC: "Cavalo",
            alternativaD: "Rainha (Dama)",
            alternativaCorreta: "alternativaD"
        },

        {
            pergunta: "A expressão 'xeque' no xadrez significa que:",
            alternativaA: "O Rei adversário está sob ataque e precisa escapar no próximo movimento",
            alternativaB: "O jogo terminou e há um vencedor",
            alternativaC: "O jogador cometeu uma infração às regras",
            alternativaD: "Um empate (afogamento) ocorreu",
            alternativaCorreta: "alternativaA"
        },

        {
            pergunta: "Quantas peças cada jogador possui no início de uma partida de xadrez?",
            alternativaA: "12",
            alternativaB: "20",
            alternativaC: "16",
            alternativaD: "8",
            alternativaCorreta: "alternativaC"
        }

    ]

    // variáveis globais    
    let numeroDaQuestaoAtual = 0
    let pontuacaoFinal = 0
    let tentativaIncorreta = 0
    let certas = 0
    let erradas = 0
    let quantidadeDeQuestoes = listaDeQuestoes.length
    // let isUltima = numeroDaQuestaoAtual == quantidadeDeQuestoes-1 ? true : false

    function onloadEsconder() {
        document.getElementById('pontuacao').style.display = "none"
        document.getElementById('jogo').style.display = "none"
    }

    function iniciarQuiz() {
        document.getElementById('pontuacao').style.display = "none"
        document.getElementById('jogo').style.display = "flex"
        document.getElementById('btnIniciarQuiz').style.display = "none"
        document.getElementById('texto_cima_botao').style.display = "none"
        document.getElementById('btnTentarNovamente').style.display = "none"

        document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes

        preencherHTMLcomQuestaoAtual(0)

        btnSubmeter.disabled = false
        btnProx.disabled = true
        // btnConcluir.disabled = true
        btnTentarNovamente.disabled = true
    }

    function preencherHTMLcomQuestaoAtual(index) {
        habilitarAlternativas(true)
        const questaoAtual = listaDeQuestoes[index]
        numeroDaQuestaoAtual = index
        console.log("questaoAtual")
        console.log(questaoAtual)
        document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1 // ajustando porque o index começa em 0
        document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
        document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
        document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
        document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
        document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
    }

    function submeter() {
        const options = document.getElementsByName("option"); // recupera alternativas no html

        let hasChecked = false
        for (let i = 0; i < options.length; i++) {
            if (options[i].checked) {
                hasChecked = true
                break
            }
        }

        if (!hasChecked) {
            alert("Não há alternativas escolhidas. Escolha uma opção.")
        } else {
            btnSubmeter.disabled = true
            btnProx.disabled = false

            habilitarAlternativas(false)

            checarResposta()
        }
    }

    function habilitarAlternativas(trueOrFalse) {
        let opcaoEscolhida = trueOrFalse ? false : true

        primeiraOpcao.disabled = opcaoEscolhida
        segundaOpcao.disabled = opcaoEscolhida
        terceiraOpcao.disabled = opcaoEscolhida
        quartaOpcao.disabled = opcaoEscolhida

    }

    function avancar() {
        btnProx.disabled = true
        btnSubmeter.disabled = false

        desmarcarRadioButtons()

        if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
        } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) {
            alert("Atenção... a próxima é a ultima questão!")
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
            document.getElementById('btnTentarNovamente').style.display = "flex"

        } else {
            finalizarJogo()
        }
        limparCoresBackgroundOpcoes()
    }

    function tentarNovamente() {
        // atualiza a página
        window.location.reload()
    }

    function checarResposta() {
        const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual] // questão atual 
        const respostaQuestaoAtual = questaoAtual.alternativaCorreta // qual é a resposta correta da questão atual

        const options = document.getElementsByName("option"); // recupera alternativas no html

        let alternativaCorreta = null // variável para armazenar a alternativa correta

        options.forEach((option) => {
            if (option.value === respostaQuestaoAtual) {
                console.log("alternativaCorreta está no componente: " + alternativaCorreta)
                alternativaCorreta = option.labels[0].id
            }
        })

        // verifica se resposta assinalada é correta
        options.forEach((option) => {
            if (option.checked === true && option.value === respostaQuestaoAtual) {
                document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                pontuacaoFinal++
                certas++
                document.getElementById("spanCertas").innerHTML = certas
                numeroDaQuestaoAtual++
            } else if (option.checked && option.value !== respostaQuestaoAtual) {
                const wrongLabelId = option.labels[0].id

                document.getElementById(wrongLabelId).classList.add("text-danger-with-bg")
                document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                tentativaIncorreta++
                erradas++
                document.getElementById("spanErradas").innerHTML = erradas
                numeroDaQuestaoAtual++
            }
        })
    }

    function limparCoresBackgroundOpcoes() {
        const options = document.getElementsByName("option");
        options.forEach((option) => {
            document.getElementById(option.labels[0].id).classList.remove("text-danger-with-bg")
            document.getElementById(option.labels[0].id).classList.remove("text-success-with-bg")
        })
    }

    function desmarcarRadioButtons() {
        const options = document.getElementsByName("option");
        for (let i = 0; i < options.length; i++) {
            options[i].checked = false;
        }
    }

    function finalizarJogo() {
        let textoParaMensagemFinal = null
        let classComCoresParaMensagemFinal = null
        const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes

        if (porcentagemFinalDeAcertos <= 0.3) {
            textoParaMensagemFinal = "Parece que você não estudou..."
            classComCoresParaMensagemFinal = "text-danger-with-bg"
        }
        else if (porcentagemFinalDeAcertos > 0.3 && porcentagemFinalDeAcertos < 0.9) {
            textoParaMensagemFinal = "Pode melhorar na próxima, hein!"
            classComCoresParaMensagemFinal = "text-warning-with-bg"
        }
        else if (porcentagemFinalDeAcertos >= 0.9) {
            textoParaMensagemFinal = "Uau, parabéns!"
            classComCoresParaMensagemFinal = "text-success-with-bg"
        }

        textoParaMensagemFinal += "<br> Você acertou " + Math.round((porcentagemFinalDeAcertos) * 100) + "% das questões."


        document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal
        document.getElementById('msgFinal').classList.add(classComCoresParaMensagemFinal)
        document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal

        document.getElementById('jogo').classList.add("text-new-gray")

        //inicio passagem de dados para o banco de dados
        const idUsuario = sessionStorage.ID_USUARIO;

        fetch("/quiz/cadastrarRespostas", {
            method: "POST",
            headers:{
            "Content-Type": "application/json",
            },
            body: JSON.stringify({
                acertos: certas,
                erros: erradas,
                pontuacao: pontuacaoFinal,
                idUsuario: idUsuario
                }),
            })
            .then(res => res.json())
            .then(resultado => {
                console.log("Resposta do servidor:", resultado);
            })
            .catch(err => {
                console.error("Erro ao cadastrar respostas:", err);
            });


        //fim passagem de dados para o banco de dados


        btnProx.disabled = true
        btnSubmeter.disabled = true
        // btnConcluir.disabled = true
        btnTentarNovamente.disabled = false

        // fetch()
    }
</script>